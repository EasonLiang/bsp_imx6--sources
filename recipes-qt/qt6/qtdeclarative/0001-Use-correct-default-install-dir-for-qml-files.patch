From c663f443a671e683c119a4c03bcc7133abc676da Mon Sep 17 00:00:00 2001
From: Samuli Piippo <samuli.piippo@qt.io>
Date: Fri, 24 Jan 2020 09:34:19 +0200
Subject: [PATCH 1/2] Use correct default install dir for qml files

Change-Id: I26b89d0e172465de3df36ffb0b2ea92975e99a2a
---
 src/particles/CMakeLists.txt       | 2 +-
 src/qml/CMakeLists.txt             | 2 +-
 src/qml/Qt6QmlMacros.cmake         | 6 +++---
 src/qmlmodels/CMakeLists.txt       | 2 +-
 src/qmlworkerscript/CMakeLists.txt | 2 +-
 src/quick/CMakeLists.txt           | 2 +-
 src/quickshapes/CMakeLists.txt     | 2 +-
 7 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/src/particles/CMakeLists.txt b/src/particles/CMakeLists.txt
index f6deceb5ae..36d77753cf 100644
--- a/src/particles/CMakeLists.txt
+++ b/src/particles/CMakeLists.txt
@@ -134,7 +134,7 @@ set_target_properties(QuickParticles PROPERTIES
     QT_QML_MODULE_INSTALL_QMLTYPES TRUE
     QT_QML_MODULE_VERSION 2.15
     QT_QML_MODULE_URI QtQuick.Particles
-    QT_QML_MODULE_INSTALL_DIR "${Qt6_DIR}/../../../qml/QtQuick/Particles"
+    QT_QML_MODULE_INSTALL_DIR "${INSTALL_QMLDIR}/QtQuick/Particles"
 )
 
 qt6_qml_type_registration(QuickParticles)
diff --git a/src/qml/CMakeLists.txt b/src/qml/CMakeLists.txt
index b61850f610..3720093e04 100644
--- a/src/qml/CMakeLists.txt
+++ b/src/qml/CMakeLists.txt
@@ -618,7 +618,7 @@ set_target_properties(Qml PROPERTIES
     QT_QML_MODULE_INSTALL_QMLTYPES TRUE
     QT_QML_MODULE_VERSION 2.15
     QT_QML_MODULE_URI QtQml
-    QT_QML_MODULE_INSTALL_DIR "${Qt6_DIR}/../../../qml/QtQml"
+    QT_QML_MODULE_INSTALL_DIR "${INSTALL_QMLDIR}/QtQml"
 )
 
 qt6_qml_type_registration(Qml)
diff --git a/src/qml/Qt6QmlMacros.cmake b/src/qml/Qt6QmlMacros.cmake
index a3778512e1..bb8339affe 100644
--- a/src/qml/Qt6QmlMacros.cmake
+++ b/src/qml/Qt6QmlMacros.cmake
@@ -28,8 +28,8 @@
 #   right location.  (OPTIONAL)
 #
 # INSTALL_LOCATION: Intended installation directory for this module. If no
-#   value is supplied, the default installation path will be ${Qt6_DIR}/qml.
-#   (OPTIONAL).
+#   value is supplied, the default installation path will be 
+#   ${INSTALL_QMLDIR}/qml. (OPTIONAL).
 #
 # DO_NOT_INSTALL_METADATA: When present, will not install the supporting files.
 #
@@ -157,7 +157,7 @@ function(qt6_add_qml_module target)
     endif()
 
     if (NOT arg_INSTALL_LOCATION)
-        set(arg_INSTALL_LOCATION "${Qt6_DIR}/../../../qml/${arg_TARGET_PATH}")
+        set(arg_INSTALL_LOCATION "${INSTALL_QMLDIR}/${arg_TARGET_PATH}")
     endif()
 
     set_target_properties(${target}
diff --git a/src/qmlmodels/CMakeLists.txt b/src/qmlmodels/CMakeLists.txt
index 7247812a29..75315ed00a 100644
--- a/src/qmlmodels/CMakeLists.txt
+++ b/src/qmlmodels/CMakeLists.txt
@@ -69,7 +69,7 @@ set_target_properties(QmlModels PROPERTIES
     QT_QML_MODULE_INSTALL_QMLTYPES TRUE
     QT_QML_MODULE_VERSION 2.15
     QT_QML_MODULE_URI QtQml.Models
-    QT_QML_MODULE_INSTALL_DIR "${Qt6_DIR}/../../../qml/QtQml/Models"
+    QT_QML_MODULE_INSTALL_DIR "${INSTALL_QMLDIR}/QtQml/Models"
 )
 
 qt6_qml_type_registration(QmlModels)
diff --git a/src/qmlworkerscript/CMakeLists.txt b/src/qmlworkerscript/CMakeLists.txt
index c7f7b60c7d..96b25be57e 100644
--- a/src/qmlworkerscript/CMakeLists.txt
+++ b/src/qmlworkerscript/CMakeLists.txt
@@ -105,7 +105,7 @@ set_target_properties(QmlWorkerScript PROPERTIES
     QT_QML_MODULE_INSTALL_QMLTYPES TRUE
     QT_QML_MODULE_VERSION 2.15
     QT_QML_MODULE_URI QtQml.WorkerScript
-    QT_QML_MODULE_INSTALL_DIR "${Qt6_DIR}/../../../qml/QtQml/WorkerScript"
+    QT_QML_MODULE_INSTALL_DIR "${INSTALL_QMLDIR}/QtQml/WorkerScript"
 )
 
 qt6_qml_type_registration(QmlWorkerScript)
diff --git a/src/quick/CMakeLists.txt b/src/quick/CMakeLists.txt
index e1e8669886..3a6c07bee0 100644
--- a/src/quick/CMakeLists.txt
+++ b/src/quick/CMakeLists.txt
@@ -603,7 +603,7 @@ set_target_properties(Quick PROPERTIES
     QT_QML_MODULE_INSTALL_QMLTYPES TRUE
     QT_QML_MODULE_VERSION 2.15
     QT_QML_MODULE_URI QtQuick
-    QT_QML_MODULE_INSTALL_DIR "${Qt6_DIR}/../../../qml/QtQuick"
+    QT_QML_MODULE_INSTALL_DIR "${INSTALL_QMLDIR}/QtQuick"
 )
 
 qt6_qml_type_registration(Quick)
diff --git a/src/quickshapes/CMakeLists.txt b/src/quickshapes/CMakeLists.txt
index cba1695d3b..a6ee71aac0 100644
--- a/src/quickshapes/CMakeLists.txt
+++ b/src/quickshapes/CMakeLists.txt
@@ -77,7 +77,7 @@ set_target_properties(QuickShapes PROPERTIES
     QT_QML_MODULE_INSTALL_QMLTYPES TRUE
     QT_QML_MODULE_VERSION 1.15
     QT_QML_MODULE_URI QtQuick.Shapes
-    QT_QML_MODULE_INSTALL_DIR "${Qt6_DIR}/../../../qml/QtQuick/Shapes"
+    QT_QML_MODULE_INSTALL_DIR "${INSTALL_QMLDIR}/QtQuick/Shapes"
 )
 
 qt6_qml_type_registration(QuickShapes)
