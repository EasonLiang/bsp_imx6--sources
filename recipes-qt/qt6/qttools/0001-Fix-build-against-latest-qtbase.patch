From 213016e3e0ff9553694bea2eae6f7c8363dc471f Mon Sep 17 00:00:00 2001
From: Lars Knoll <lars.knoll@qt.io>
Date: Mon, 24 Aug 2020 17:51:17 +0200
Subject: [PATCH] Fix build against latest qtbase

Change-Id: Id099dbd755815a41e3e19d530c9669a6c73c8731
---
 src/designer/src/uitools/quiloader.cpp | 1 -
 src/designer/src/uitools/quiloader_p.h | 7 ++++++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/designer/src/uitools/quiloader.cpp b/src/designer/src/uitools/quiloader.cpp
index ccfd4478..764695a6 100644
--- a/src/designer/src/uitools/quiloader.cpp
+++ b/src/designer/src/uitools/quiloader.cpp
@@ -650,7 +650,6 @@ QUiLoader::QUiLoader(QObject *parent)
     static int metaTypeId = 0;
     if (!metaTypeId) {
         metaTypeId = qRegisterMetaType<QUiTranslatableStringValue>("QUiTranslatableStringValue");
-        qRegisterMetaTypeStreamOperators<QUiTranslatableStringValue>("QUiTranslatableStringValue");
     }
 #endif // QT_NO_DATASTREAM
     d->builder.loader = this;
diff --git a/src/designer/src/uitools/quiloader_p.h b/src/designer/src/uitools/quiloader_p.h
index 632eb6ef..abf91fd1 100644
--- a/src/designer/src/uitools/quiloader_p.h
+++ b/src/designer/src/uitools/quiloader_p.h
@@ -69,7 +69,7 @@ QT_FORWARD_DECLARE_CLASS(QDataStream)
 
 QT_BEGIN_NAMESPACE
 
-class QUiTranslatableStringValue
+class Q_UITOOLS_EXPORT QUiTranslatableStringValue
 {
 public:
     QByteArray value() const { return m_value; }
@@ -86,6 +86,11 @@ private:
     QByteArray m_qualifier; // Comment or ID for id-based tr().
 };
 
+#ifndef QT_NO_DATASTREAM
+Q_UITOOLS_EXPORT QDataStream &operator<<(QDataStream &out, const QUiTranslatableStringValue &s);
+Q_UITOOLS_EXPORT QDataStream &operator>>(QDataStream &in, QUiTranslatableStringValue &s);
+#endif // QT_NO_DATASTREAM
+
 struct QUiItemRolePair {
     int realRole;
     int shadowRole;
