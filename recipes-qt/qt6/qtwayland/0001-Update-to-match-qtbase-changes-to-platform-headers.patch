From 9f2a6a018bff6b5ec98145444a7d0b5390a4afbf Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Tor=20Arne=20Vestb=C3=B8?= <tor.arne.vestbo@qt.io>
Date: Wed, 5 Aug 2020 12:27:10 +0200
Subject: [PATCH] Update to match qtbase changes to platform headers

Change-Id: I8e39d87361728c81b526f1ad89b45136500c9913
---
 CMakeLists.txt                                |   1 -
 src/client/CMakeLists.txt                     |   1 -
 src/client/client.pro                         |   2 -
 src/client/qwaylandnativeinterface.cpp        |  40 -----
 src/client/qwaylandnativeinterface_p.h        |   6 -
 .../vsp2/vsp2hardwarelayerintegration.cpp     |  26 ++--
 .../vsp2/vsp2hardwarelayerintegration.h       |   6 +-
 tests/manual/subsurface/CMakeLists.txt        |  35 -----
 tests/manual/subsurface/child.qml             |  77 ----------
 tests/manual/subsurface/main.cpp              | 141 ------------------
 tests/manual/subsurface/main.qml              | 100 -------------
 tests/manual/subsurface/qml.qrc               |   6 -
 tests/manual/subsurface/shmwindow.cpp         |  84 -----------
 tests/manual/subsurface/shmwindow.h           |  70 ---------
 tests/manual/subsurface/subsurface.pro        |  17 ---
 15 files changed, 22 insertions(+), 590 deletions(-)
 delete mode 100644 tests/manual/subsurface/CMakeLists.txt
 delete mode 100644 tests/manual/subsurface/child.qml
 delete mode 100644 tests/manual/subsurface/main.cpp
 delete mode 100644 tests/manual/subsurface/main.qml
 delete mode 100644 tests/manual/subsurface/qml.qrc
 delete mode 100644 tests/manual/subsurface/shmwindow.cpp
 delete mode 100644 tests/manual/subsurface/shmwindow.h
 delete mode 100644 tests/manual/subsurface/subsurface.pro

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 88223a41..e72c5e1c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -27,7 +27,6 @@ find_package(Qt6 ${PROJECT_VERSION} CONFIG REQUIRED COMPONENTS
     Core
     Gui
     OpenGL
-    PlatformHeaders
 )
 
 find_package(Qt6 ${PROJECT_VERSION} CONFIG OPTIONAL_COMPONENTS
diff --git a/src/client/CMakeLists.txt b/src/client/CMakeLists.txt
index b49a7292..88b27b5f 100644
--- a/src/client/CMakeLists.txt
+++ b/src/client/CMakeLists.txt
@@ -56,7 +56,6 @@ qt_add_module(WaylandClient
     LIBRARIES
         Qt::CorePrivate
         Qt::GuiPrivate
-        Qt::PlatformHeadersPrivate
     PUBLIC_LIBRARIES
         Qt::Core
         Qt::Gui
diff --git a/src/client/client.pro b/src/client/client.pro
index 38b129e9..d6df946b 100644
--- a/src/client/client.pro
+++ b/src/client/client.pro
@@ -3,8 +3,6 @@ MODULE = waylandclient
 
 QT += core-private gui-private
 
-QT_PRIVATE += platformheaders-private
-
 # We have a bunch of C code with casts, so we can't have this option
 QMAKE_CXXFLAGS_WARN_ON -= -Wcast-qual
 
diff --git a/src/client/qwaylandnativeinterface.cpp b/src/client/qwaylandnativeinterface.cpp
index da788547..2c9ba899 100644
--- a/src/client/qwaylandnativeinterface.cpp
+++ b/src/client/qwaylandnativeinterface.cpp
@@ -55,8 +55,6 @@
 #include <QtWaylandClient/private/qwaylandvulkanwindow_p.h>
 #endif
 
-#include <QtPlatformHeaders/private/qwaylandwindowfunctions_p.h>
-
 QT_BEGIN_NAMESPACE
 
 namespace QtWaylandClient {
@@ -194,44 +192,6 @@ void QWaylandNativeInterface::emitWindowPropertyChanged(QPlatformWindow *window,
     emit windowPropertyChanged(window,name);
 }
 
-QFunctionPointer QWaylandNativeInterface::platformFunction(const QByteArray &resource) const
-{
-    if (resource == QWaylandWindowFunctions::setSyncIdentifier()) {
-        return QFunctionPointer(setSync);
-    } else if (resource == QWaylandWindowFunctions::setDeSyncIdentifier()) {
-        return QFunctionPointer(setDeSync);
-    } else if (resource == QWaylandWindowFunctions::isSyncIdentifier()) {
-        return QFunctionPointer(isSync);
-    }
-    return nullptr;
-}
-
-
-void QWaylandNativeInterface::setSync(QWindow *window)
-{
-    QWaylandWindow *ww = static_cast<QWaylandWindow*>(window->handle());
-    if (ww->subSurfaceWindow()) {
-        ww->subSurfaceWindow()->setSync();
-    }
-}
-
-void QWaylandNativeInterface::setDeSync(QWindow *window)
-{
-    QWaylandWindow *ww = static_cast<QWaylandWindow*>(window->handle());
-    if (ww->subSurfaceWindow()) {
-        ww->subSurfaceWindow()->setDeSync();
-    }
-}
-
-bool QWaylandNativeInterface::isSync(QWindow *window)
-{
-    QWaylandWindow *ww = static_cast<QWaylandWindow*>(window->handle());
-    if (ww->subSurfaceWindow()) {
-        return ww->subSurfaceWindow()->isSync();
-    }
-    return false;
-}
-
 }
 
 QT_END_NAMESPACE
diff --git a/src/client/qwaylandnativeinterface_p.h b/src/client/qwaylandnativeinterface_p.h
index 3de80eb6..0edbdc9e 100644
--- a/src/client/qwaylandnativeinterface_p.h
+++ b/src/client/qwaylandnativeinterface_p.h
@@ -82,15 +82,9 @@ public:
 
     void emitWindowPropertyChanged(QPlatformWindow *window, const QString &name);
 
-    QFunctionPointer platformFunction(const QByteArray &resource) const override;
-
 private:
     QWaylandIntegration *m_integration = nullptr;
     QHash<QPlatformWindow*, QVariantMap> m_windowProperties;
-
-    static void setSync(QWindow *window);
-    static void setDeSync(QWindow *window);
-    static bool isSync(QWindow *window);
 };
 
 }
diff --git a/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.cpp b/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.cpp
index a0abf697..ad25d88f 100644
--- a/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.cpp
+++ b/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.cpp
@@ -41,7 +41,9 @@ extern "C" {
 #include <QWaylandQuickOutput>
 #include <QQuickWindow>
 
-#include <QtPlatformHeaders/qeglfsfunctions.h>
+#include <qpa/qlatformscreen_p.h>
+
+using namespace QPlatformInterface::Private;
 
 QT_BEGIN_NAMESPACE
 
@@ -56,6 +58,10 @@ Vsp2Buffer::Vsp2Buffer(wl_kms_buffer *kmsBuffer)
 Vsp2Layer::Vsp2Layer(QWaylandQuickHardwareLayer *hwLayer, Vsp2HardwareLayerIntegration *integration)
     : m_hwLayer(hwLayer)
 {
+    auto *wlItem = m_hwLayer->waylandItem();
+    m_screen = dynamic_cast<QVsp2Screen*>(wlItem->window()->screen()->handle());
+    Q_ASSERT(m_screen);
+
     connect(hwLayer, &QWaylandQuickHardwareLayer::stackingLevelChanged, this, [integration](){
         integration->recreateVspLayers();
     });
@@ -76,16 +82,17 @@ void Vsp2Layer::enableVspLayer()
 
     m_buffer = Vsp2Buffer(kmsBuffer);
     updatePosition();
+
+    m_layerIndex = m_screen->addLayer(m_buffer.dmabufFd, m_buffer.size, m_position, m_buffer.drmPixelFormat, m_buffer.bytesPerLine);
+
     auto *wlItem = m_hwLayer->waylandItem();
-    m_screen = wlItem->window()->screen();
-    m_layerIndex = QEglFSFunctions::vsp2AddLayer(m_screen, m_buffer.dmabufFd, m_buffer.size, m_position, m_buffer.drmPixelFormat, m_buffer.bytesPerLine);
     wlItem->surface()->frameStarted();
     updateOpacity();
 }
 
 void Vsp2Layer::disableVspLayer()
 {
-    QEglFSFunctions::vsp2RemoveLayer(m_screen, m_layerIndex);
+    m_screen->removeLayer(m_layerIndex);
     m_layerIndex = -1;
     m_screen = nullptr;
 }
@@ -112,9 +119,9 @@ void Vsp2Layer::handleBufferCommitted()
     }
 
     m_buffer = newBuffer;
+    m_screen->setLayerBuffer(m_layerIndex, m_buffer.dmabufFd);
+
     auto *wlItem = m_hwLayer->waylandItem();
-    m_screen = wlItem->window()->screen();
-    QEglFSFunctions::vsp2SetLayerBuffer(m_screen, m_layerIndex, m_buffer.dmabufFd);
     wlItem->surface()->frameStarted();
 }
 
@@ -147,14 +154,14 @@ void Vsp2Layer::updatePosition()
 
     m_position = globalGeometry.topLeft().toPoint();
     if (isEnabled())
-        QEglFSFunctions::vsp2SetLayerPosition(m_screen, m_layerIndex, m_position);
+        m_screen->setLayerPosition(m_layerIndex, m_position);
 }
 
 void Vsp2Layer::updateOpacity()
 {
     if (isEnabled()) {
         qreal opacity = m_hwLayer->waylandItem()->opacity();
-        QEglFSFunctions::vsp2SetLayerAlpha(m_screen, m_layerIndex, opacity);
+        m_screen->setLayerAlpha(m_layerIndex, opacity);
     }
 }
 
@@ -216,7 +223,8 @@ Vsp2HardwareLayerIntegration::Vsp2HardwareLayerIntegration()
                    << "You need to set QT_QPA_PLATFORM=eglfs and QT_QPA_EGLFS_INTEGRATION=eglfs_kms_vsp2";
     }
     static Vsp2HardwareLayerIntegration *s_instance = this;
-    QEglFSFunctions::vsp2AddBlendListener(QGuiApplication::primaryScreen(), [](){
+    auto screen = dynamic_cast<QVsp2Screen*>(QGuiApplication::primaryScreen()->handle());
+    screen->addBlendListener([](){
         s_instance->sendFrameCallbacks();
     });
 }
diff --git a/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.h b/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.h
index 263c5026..f72bbc3e 100644
--- a/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.h
+++ b/src/hardwareintegration/compositor/hardwarelayer/vsp2/vsp2hardwarelayerintegration.h
@@ -40,6 +40,10 @@ struct wl_kms_buffer;
 
 QT_BEGIN_NAMESPACE
 
+namespace QPlatformInterface::Private {
+struct QVsp2Screen;
+}
+
 class QScreen;
 class QWaylandSurface;
 class QWaylandQuickHardwareLayer;
@@ -95,7 +99,7 @@ public slots:
 private:
     wl_kms_buffer *nextKmsBuffer();
     int m_layerIndex = -1;
-    QScreen *m_screen = nullptr;
+    QVsp2Screen *m_screen = nullptr;
     QPoint m_position;
     QWaylandQuickHardwareLayer *m_hwLayer = nullptr;
     QWaylandSurface *m_surface = nullptr;
diff --git a/tests/manual/subsurface/CMakeLists.txt b/tests/manual/subsurface/CMakeLists.txt
deleted file mode 100644
index fd450f20..00000000
--- a/tests/manual/subsurface/CMakeLists.txt
+++ /dev/null
@@ -1,35 +0,0 @@
-# Generated from subsurface.pro.
-
-#####################################################################
-## subsurface Binary:
-#####################################################################
-
-qt_add_manual_test(subsurface
-    GUI
-    SOURCES
-        main.cpp
-        shmwindow.cpp shmwindow.h
-    PUBLIC_LIBRARIES
-        Qt::CorePrivate
-        Qt::Gui
-        Qt::GuiPrivate
-        Qt::Quick
-        Qt::WaylandClient
-)
-
-# Resources:
-set(qml_resource_files
-    "child.qml"
-    "main.qml"
-)
-
-qt_add_resource(subsurface "qml"
-    PREFIX
-        "/"
-    FILES
-        ${qml_resource_files}
-)
-
-
-#### Keys ignored in scope 1:.:.:subsurface.pro:<TRUE>:
-# TEMPLATE = "app"
diff --git a/tests/manual/subsurface/child.qml b/tests/manual/subsurface/child.qml
deleted file mode 100644
index f1bdd66e..00000000
--- a/tests/manual/subsurface/child.qml
+++ /dev/null
@@ -1,77 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2015 LG Electronics Inc, author: <mikko.levonmaa@lge.com>
-** Contact: https://www.qt.io/licensing/
-**
-** This file is part of the examples of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:BSD$
-** Commercial License Usage
-** Licensees holding valid commercial Qt licenses may use this file in
-** accordance with the commercial license agreement provided with the
-** Software or, alternatively, in accordance with the terms contained in
-** a written agreement between you and The Qt Company. For licensing terms
-** and conditions see https://www.qt.io/terms-conditions. For further
-** information use the contact form at https://www.qt.io/contact-us.
-**
-** BSD License Usage
-** Alternatively, you may use this file under the terms of the BSD license
-** as follows:
-**
-** "Redistribution and use in source and binary forms, with or without
-** modification, are permitted provided that the following conditions are
-** met:
-**   * Redistributions of source code must retain the above copyright
-**     notice, this list of conditions and the following disclaimer.
-**   * Redistributions in binary form must reproduce the above copyright
-**     notice, this list of conditions and the following disclaimer in
-**     the documentation and/or other materials provided with the
-**     distribution.
-**   * Neither the name of The Qt Company Ltd nor the names of its
-**     contributors may be used to endorse or promote products derived
-**     from this software without specific prior written permission.
-**
-**
-** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
-** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-import QtQuick 2.4
-import QtQuick.Window 2.2
-
-Rectangle {
-    width: 300
-    height: 300
-
-    color: "darkgray"
-
-    Rectangle {
-        width: 100
-        height: 100
-        color: "magenta"
-
-        Text {
-            anchors.centerIn: parent
-            text: "quick"
-        }
-
-        RotationAnimation on rotation {
-            duration: 10000
-            loops: Animation.Infinite
-            from: 0
-            to: 360
-        }
-    }
-}
diff --git a/tests/manual/subsurface/main.cpp b/tests/manual/subsurface/main.cpp
deleted file mode 100644
index 375e5d2b..00000000
--- a/tests/manual/subsurface/main.cpp
+++ /dev/null
@@ -1,141 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2015 LG Electronics Inc, author: <mikko.levonmaa@lge.com>
-** Contact: https://www.qt.io/licensing/
-**
-** This file is part of the examples of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:BSD$
-** Commercial License Usage
-** Licensees holding valid commercial Qt licenses may use this file in
-** accordance with the commercial license agreement provided with the
-** Software or, alternatively, in accordance with the terms contained in
-** a written agreement between you and The Qt Company. For licensing terms
-** and conditions see https://www.qt.io/terms-conditions. For further
-** information use the contact form at https://www.qt.io/contact-us.
-**
-** BSD License Usage
-** Alternatively, you may use this file under the terms of the BSD license
-** as follows:
-**
-** "Redistribution and use in source and binary forms, with or without
-** modification, are permitted provided that the following conditions are
-** met:
-**   * Redistributions of source code must retain the above copyright
-**     notice, this list of conditions and the following disclaimer.
-**   * Redistributions in binary form must reproduce the above copyright
-**     notice, this list of conditions and the following disclaimer in
-**     the documentation and/or other materials provided with the
-**     distribution.
-**   * Neither the name of The Qt Company Ltd nor the names of its
-**     contributors may be used to endorse or promote products derived
-**     from this software without specific prior written permission.
-**
-**
-** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
-** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include <QGuiApplication>
-#include <QQmlEngine>
-#include <QQmlFileSelector>
-#include <QQmlContext>
-#include <QQuickView>
-
-#include <QtPlatformHeaders/qwaylandwindowfunctions.h>
-
-#include "shmwindow.h"
-
-class Filter : public QObject
-{
-    Q_OBJECT
-    Q_PROPERTY(bool sync READ getSync NOTIFY syncChanged)
-
-public:
-    Filter()
-    {
-        sync = false;
-    }
-
-    bool eventFilter(QObject *object, QEvent *event)
-    {
-        Q_UNUSED(object);
-        if (event->type() == QEvent::KeyPress) {
-            QKeyEvent *keyEvent = static_cast<QKeyEvent *>(event);
-            if (keyEvent->key() == Qt::Key_Space) {
-                toggleSync(quick);
-                toggleSync(shm);
-            }
-        }
-        return false;
-    }
-
-    void toggleSync(QWindow *w)
-    {
-        sync = !QWaylandWindowFunctions::isSync(w);
-        if (QWaylandWindowFunctions::isSync(w))
-            QWaylandWindowFunctions::setDeSync(w);
-        else
-            QWaylandWindowFunctions::setSync(w);
-        emit syncChanged();
-    }
-
-    bool getSync() const
-    {
-        return sync;
-    }
-
-Q_SIGNALS:
-    void syncChanged();
-
-public:
-    QWindow *quick;
-    QWindow *shm;
-    bool sync;
-};
-
-int main(int argc, char* argv[])
-{
-    QGuiApplication app(argc, argv);
-    QQuickView view;
-    view.connect(view.engine(), SIGNAL(quit()), &app, SLOT(quit()));
-    view.setResizeMode(QQuickView::SizeRootObjectToView);
-
-    Filter f;
-    view.rootContext()->setContextProperty("syncStatus", &f);
-    view.installEventFilter(&f);
-
-    view.setSource(QUrl("qrc:/main.qml"));
-    view.show();
-
-    QQuickView child(&view);
-    child.connect(child.engine(), SIGNAL(quit()), &app, SLOT(quit()));
-    child.setSource(QUrl("qrc:/child.qml"));
-    child.setResizeMode(QQuickView::SizeRootObjectToView);
-    child.setGeometry(QRect(150, 70, 100, 100));
-    child.show();
-
-    ShmWindow shm(&view);
-    shm.setGeometry(QRect(30, 30, 50, 50));
-    shm.show();
-
-    f.quick = &child;
-    f.shm = &shm;
-
-    return app.exec();
-}
-
-#include "main.moc"
-
diff --git a/tests/manual/subsurface/main.qml b/tests/manual/subsurface/main.qml
deleted file mode 100644
index 8c27ac78..00000000
--- a/tests/manual/subsurface/main.qml
+++ /dev/null
@@ -1,100 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2015 LG Electronics Inc, author: <mikko.levonmaa@lge.com>
-** Contact: https://www.qt.io/licensing/
-**
-** This file is part of the examples of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:BSD$
-** Commercial License Usage
-** Licensees holding valid commercial Qt licenses may use this file in
-** accordance with the commercial license agreement provided with the
-** Software or, alternatively, in accordance with the terms contained in
-** a written agreement between you and The Qt Company. For licensing terms
-** and conditions see https://www.qt.io/terms-conditions. For further
-** information use the contact form at https://www.qt.io/contact-us.
-**
-** BSD License Usage
-** Alternatively, you may use this file under the terms of the BSD license
-** as follows:
-**
-** "Redistribution and use in source and binary forms, with or without
-** modification, are permitted provided that the following conditions are
-** met:
-**   * Redistributions of source code must retain the above copyright
-**     notice, this list of conditions and the following disclaimer.
-**   * Redistributions in binary form must reproduce the above copyright
-**     notice, this list of conditions and the following disclaimer in
-**     the documentation and/or other materials provided with the
-**     distribution.
-**   * Neither the name of The Qt Company Ltd nor the names of its
-**     contributors may be used to endorse or promote products derived
-**     from this software without specific prior written permission.
-**
-**
-** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
-** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-import QtQuick 2.4
-import QtQuick.Window 2.2
-
-Rectangle {
-    id: root
-
-    width: 300
-    height: 300
-
-    color: "blue"
-
-    Rectangle {
-        id: r
-        width: 100
-        height: 100
-        x: (parent.width - width) / 2
-        y: (parent.height - height) / 2
-        color: "cyan"
-
-        MouseArea {
-            anchors.fill: parent
-            drag.target: r
-            drag.axis: Drag.XAndYAxis
-        }
-    }
-
-    Text {
-        anchors.bottom: parent.bottom
-        anchors.horizontalCenter: parent.horizontalCenter
-        text: syncStatus.sync ? "sync mode" : "de-sync mode"
-    }
-
-    // If you can see these rectangles, something's not right
-    Rectangle {
-        //Child at (150, 70, 100, 100)
-        color: "yellow"
-        x: 150
-        y: 70
-        width:100
-        height:100
-    }
-    Rectangle {
-        //Shm at (30, 30, 50, 50)
-        color: "yellow"
-        x: 30
-        y: 30
-        width: 50
-        height: 50
-    }
-}
diff --git a/tests/manual/subsurface/qml.qrc b/tests/manual/subsurface/qml.qrc
deleted file mode 100644
index f81739af..00000000
--- a/tests/manual/subsurface/qml.qrc
+++ /dev/null
@@ -1,6 +0,0 @@
-<!DOCTYPE RCC><RCC version="1.0">
-<qresource>
-    <file>main.qml</file>
-    <file>child.qml</file>
-</qresource>
-</RCC>
diff --git a/tests/manual/subsurface/shmwindow.cpp b/tests/manual/subsurface/shmwindow.cpp
deleted file mode 100644
index 32358210..00000000
--- a/tests/manual/subsurface/shmwindow.cpp
+++ /dev/null
@@ -1,84 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2015 LG Electronics Ltd, author: <mikko.levonmaa@lge.com>
-** Contact: https://www.qt.io/licensing/
-**
-** This file is part of the examples of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:BSD$
-** Commercial License Usage
-** Licensees holding valid commercial Qt licenses may use this file in
-** accordance with the commercial license agreement provided with the
-** Software or, alternatively, in accordance with the terms contained in
-** a written agreement between you and The Qt Company. For licensing terms
-** and conditions see https://www.qt.io/terms-conditions. For further
-** information use the contact form at https://www.qt.io/contact-us.
-**
-** BSD License Usage
-** Alternatively, you may use this file under the terms of the BSD license
-** as follows:
-**
-** "Redistribution and use in source and binary forms, with or without
-** modification, are permitted provided that the following conditions are
-** met:
-**   * Redistributions of source code must retain the above copyright
-**     notice, this list of conditions and the following disclaimer.
-**   * Redistributions in binary form must reproduce the above copyright
-**     notice, this list of conditions and the following disclaimer in
-**     the documentation and/or other materials provided with the
-**     distribution.
-**   * Neither the name of The Qt Company Ltd nor the names of its
-**     contributors may be used to endorse or promote products derived
-**     from this software without specific prior written permission.
-**
-**
-** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
-** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#include "shmwindow.h"
-
-#include <QPainter>
-#include <QDebug>
-
-ShmWindow::ShmWindow(QWindow *parent)
-   : QRasterWindow(parent)
-   , m_rotation(0)
-{
-    m_timer = startTimer(100);
-}
-
-void ShmWindow::timerEvent(QTimerEvent *event)
-{
-    if (event->timerId() == m_timer) {
-        m_rotation++;
-        update();
-    }
-}
-
-void ShmWindow::paintEvent(QPaintEvent *event)
-{
-    Q_UNUSED(event);
-    QPainter painter(this);
-
-    painter.fillRect(0, 0, width(), height(), Qt::white);
-
-    qreal xc = width() * 0.5;
-    qreal yc = height() * 0.5;
-    painter.translate(xc, yc);
-    painter.rotate(m_rotation);
-    painter.drawText(QRectF(-xc, -yc, width(), height()), Qt::AlignCenter, QStringLiteral("SHM"));
-}
-
diff --git a/tests/manual/subsurface/shmwindow.h b/tests/manual/subsurface/shmwindow.h
deleted file mode 100644
index 10041eea..00000000
--- a/tests/manual/subsurface/shmwindow.h
+++ /dev/null
@@ -1,70 +0,0 @@
-/****************************************************************************
-**
-** Copyright (C) 2015 LG Electronics Ltd, author: <mikko.levonmaa@lge.com>
-** Contact: https://www.qt.io/licensing/
-**
-** This file is part of the examples of the Qt Toolkit.
-**
-** $QT_BEGIN_LICENSE:BSD$
-** Commercial License Usage
-** Licensees holding valid commercial Qt licenses may use this file in
-** accordance with the commercial license agreement provided with the
-** Software or, alternatively, in accordance with the terms contained in
-** a written agreement between you and The Qt Company. For licensing terms
-** and conditions see https://www.qt.io/terms-conditions. For further
-** information use the contact form at https://www.qt.io/contact-us.
-**
-** BSD License Usage
-** Alternatively, you may use this file under the terms of the BSD license
-** as follows:
-**
-** "Redistribution and use in source and binary forms, with or without
-** modification, are permitted provided that the following conditions are
-** met:
-**   * Redistributions of source code must retain the above copyright
-**     notice, this list of conditions and the following disclaimer.
-**   * Redistributions in binary form must reproduce the above copyright
-**     notice, this list of conditions and the following disclaimer in
-**     the documentation and/or other materials provided with the
-**     distribution.
-**   * Neither the name of The Qt Company Ltd nor the names of its
-**     contributors may be used to endorse or promote products derived
-**     from this software without specific prior written permission.
-**
-**
-** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
-** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
-**
-** $QT_END_LICENSE$
-**
-****************************************************************************/
-
-#ifndef SHMWINDOW_H
-#define SHMWINDOW_H
-
-#include <QtGui>
-
-class ShmWindow : public QRasterWindow
-{
-    Q_OBJECT
-public:
-    explicit ShmWindow(QWindow *parent);
-
-protected:
-    void paintEvent(QPaintEvent *event) override;
-    void timerEvent(QTimerEvent *) override;
-
-private:
-    int m_rotation;
-    int m_timer;
-};
-#endif // SHMWINDOW_H
diff --git a/tests/manual/subsurface/subsurface.pro b/tests/manual/subsurface/subsurface.pro
deleted file mode 100644
index 5371ac5f..00000000
--- a/tests/manual/subsurface/subsurface.pro
+++ /dev/null
@@ -1,17 +0,0 @@
-TEMPLATE = app
-
-QT += \
-    gui gui-private core-private\
-    quick \
-    waylandclient \
-
-HEADERS += \
-    shmwindow.h \
-
-SOURCES += \
-    main.cpp \
-    shmwindow.cpp \
-
-RESOURCES += \
-    qml.qrc
-
